<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" media="screen" href="./styles/styles.css" />
  <title>Code Commando</title>
</head>

<body>
  <nav>
    <ul id="navigation">
      <li id="nav-home">
        <a>Home</a>
      </li>
      <li id="nav-quiz">
        <a>Quiz</a>
      </li>
      <li id="nav-roster">
        <a>Roster</a>
      </li>
      <li id="nav-random">
        <a>Random</a>
      </li>
      <li id="nav-pairs">
        <a>Pairs</a>
      </li>
      <li id="nav-repl">
        <a>Repl</a>
      </li>
    </ul>
    <ul id="auth">
      <li id="login">
        <a>Log In</a>
      </li>
      <li id="signup">
        <a>Sign Up</a>
      </li>
    </ul>
  </nav>
  <div id="home">
    <div id="courses" class="clearDiv"></div>
    <form id='new-class' style='display:none;'>
      Class Code
      <input type="text" name="classCode">
      <br> Class Repo
      <input type="text" name="githubRepo">
      <br>
      <input type="submit" value="Submit">
    </form>
    <p id='suc-message'></p>
  </div>
  <div id="days" style="display:none;">
  </div>
  <div id='readMe' class="clearDiv"></div>
  <div id="quiz" class="clearDiv"></div>
  <div id="roster" class="clearDiv"></div>
  <div id="pairs" class="clearDiv"></div>
  <div id="random" class="clearDiv"></div>
  <textarea readonly class="clearDiv" id="resultWindow" style="display:none; resize:both;" rows="34" cols="50">Console Output</textarea>
  <div id="repl" class="clearDiv"></div>

  <div id="files" class="clearDiv"></div>
  <div>
    <button style="height:2em;width:5em;font-weight: bold;font-size: 0.75em;display:none;" id='run' type="submit">Run</button>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<script>window.$ = window.jQuery = require('jquery');</script>
<script src="./app.js"></script>
<script>if (window.module) module = window.module;</script>

<script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
<script>
  // Save Monaco's amd require and restore Node's require
  var amdRequire = global.require;
  global.require = nodeRequire;
</script>

<script>
  import superagent from 'superagent';
  // require node modules before loader.js comes in
  var path = require('path');

  function uriFromPath(_path) {
    var pathName = path.resolve(_path).replace(/\\/g, '/');
    if (pathName.length > 0 && pathName.charAt(0) !== '/') {
      pathName = '/' + pathName;
    }
    return encodeURI('file://' + pathName);
  }
  amdRequire.config({
    baseUrl: uriFromPath(path.join(__dirname, '../node_modules/monaco-editor/min'))
  });
  // workaround monaco-css not understanding the environment
  self.module = undefined;
  // workaround monaco-typescript not understanding the environment
  self.process.browser = true;
  var editor;


  $('#files').on('click', (event) => {
    if (event.target.nodeName === 'LI') {
      if (event.target.id === 'new-file') {
        runEditor('// Create your code and hit run at the end');
      } else {
        return superagent.get(event.target.id)
          .then(data => {
            runEditor(data.text)
          });
      }
    }

  });

  function runEditor(data) {

    console.log(data.text);
    //   $('#home').hide();
    $('#days').hide();
    (function () {
      $('#run').hide();
      let obj = document.getElementsByClassName('clearDiv');
      Object.values(obj).forEach(div => {
        div.innerHTML = '';
      });
    })();

    amdRequire(['vs/editor/editor.main'], function () {
      editor = monaco.editor.create(document.getElementById('repl'), {
        value: [
          data
        ].join('\n'),
        language: 'javascript'
      });
    });
    $('#repl').css({
      'width': '400',
      'height': '467',
      'float': 'left',
      'clear': 'left',
    })
    $('#resultWindow').css({
      // 'float': 'left',
      'background-color': 'black',
      'color': 'white',
    })
    $('#resultWindow').show()
    $('#resultWindow').text('Output Console')
    $('#run').show()

  }

  $('#run').on('click', function (e) {
    e.preventDefault();
    $('#resultWindow').empty();
    let data = editor.getValue();
    let obj = {}
    obj.code = data;
    obj.day = '01-node-ecosystem'
    // line 137: change to grab from textContent of event click;
    obj.language = 'javascript';
    // obj.sha = '563cec42a9bdbee9d7c0a2428486dcbe094f2f51'
    console.log('data -->', obj);
   
      superagent.post('http://api.commando.ccs.net/api/v1/code')
      .send(obj)
      .then(data => {
        if(data.body.traceback) $('#resultWindow').text(data.body.traceback);
        if(data.body.return) $('#resultWindow').text(data.body.return);
      })
    });
 
</script>

</html>